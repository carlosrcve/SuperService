{% extends "base.html" %}

{% load static %}

{% block title %}Dashboard de Conductor{% endblock %}

{% block content %}
<div class="container py-4">
    
    <div class="row mb-4 align-items-center">
        <div class="col-md-8">
            <h1 class="fw-bold text-warning">
                <i class="bi bi-speedometer2 me-2"></i> Dashboard de Proveedor
            </h1>
            <p class="lead text-muted">Aquí gestionas tu estado, ganancias y aceptas nuevos servicios.</p>
        </div>
        <div class="col-md-4 text-md-end">
            <!-- Botón de Estado de Conexión -->
            <button id="toggle-status" class="btn btn-lg fw-bold shadow-lg status-button status-online">
                <i class="bi bi-toggle-on me-2"></i> Estado: Conectado
            </button>
        </div>
    </div>
    
    <!-- ---------------------------------------------------- -->
    <!-- Sección de Métricas (Cards de Resumen) -->
    <!-- ---------------------------------------------------- -->
    <div class="row row-cols-1 row-cols-md-3 g-4 mb-5">
        
        <!-- Métrica 1: Calificación -->
        <div class="col">
            <div class="card h-100 shadow-sm border-warning" style="border-radius: 12px;">
                <div class="card-body text-center p-4">
                    <i class="bi bi-star-fill text-warning display-5 mb-2"></i>
                    <h3 class="card-title fw-bold">Calificación</h3>
                    <p class="display-4 fw-bolder text-warning mb-0">4.85</p>
                    <p class="text-muted small">Promedio de los últimos 100 servicios</p>
                </div>
            </div>
        </div>
        
        <!-- Métrica 2: Ganancias Diarias -->
        <div class="col">
            <div class="card h-100 shadow-sm border-success" style="border-radius: 12px;">
                <div class="card-body text-center p-4">
                    <i class="bi bi-wallet-fill text-success display-5 mb-2"></i>
                    <h3 class="card-title fw-bold">Ganancia de Hoy</h3>
                    <p class="display-4 fw-bolder text-success mb-0">$55.00</p>
                    <p class="text-muted small">Total acumulado hasta ahora</p>
                </div>
            </div>
        </div>
        
        <!-- Métrica 3: Servicios Completados -->
        <div class="col">
            <div class="card h-100 shadow-sm border-primary" style="border-radius: 12px;">
                <div class="card-body text-center p-4">
                    <i class="bi bi-check-circle-fill text-primary display-5 mb-2"></i>
                    <h3 class="card-title fw-bold">Servicios Hoy</h3>
                    <p class="display-4 fw-bolder text-primary mb-0">12</p>
                    <p class="text-muted small">Viajes y/o domicilios finalizados</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ---------------------------------------------------- -->
    <!-- Sección de Solicitudes Pendientes -->
    <!-- ---------------------------------------------------- -->
    <h2 class="fw-bold mb-4 text-warning"><i class="bi bi-bell-fill me-2"></i> Nuevas Solicitudes de Servicio</h2>
    
    <div id="service-requests" class="row row-cols-1 g-3">
        
        <!-- Solicitud 1: Viaje (Primario) -->
        <div class="col">
            <div class="card shadow border-primary request-card hover-lift" data-service-type="viaje">
                <div class="card-body d-flex justify-content-between align-items-center p-4">
                    
                    <div class="d-flex align-items-center">
                        <i class="bi bi-car-front-fill display-5 text-primary me-4"></i>
                        <div>
                            <span class="badge bg-primary mb-1 fw-bold">VIAJE</span>
                            <h5 class="card-title fw-bold mb-1">Solicitud de Transporte Estándar</h5>
                            <p class="mb-0 text-muted small">
                                De: **Av. Francisco de Miranda** a **Centro Comercial**
                            </p>
                            <p class="mb-0 text-muted small">
                                Distancia: **4.2 km** | Ganancia Estimada: **$8.50**
                            </p>
                        </div>
                    </div>

                    <div class="text-end">
                        <span class="text-primary fw-bold d-block mb-2" style="font-size: 1.5rem;">2 min</span>
                        <button class="btn btn-success fw-bold me-2 accept-button"><i class="bi bi-check2"></i> Aceptar</button>
                        <button class="btn btn-danger reject-button"><i class="bi bi-x"></i></button>
                    </div>

                </div>
            </div>
        </div>
        
        <!-- Solicitud 2: Domicilio (Secundario/Éxito) -->
        <div class="col">
            <div class="card shadow border-success request-card hover-lift" data-service-type="domicilio">
                <div class="card-body d-flex justify-content-between align-items-center p-4">
                    
                    <div class="d-flex align-items-center">
                        <i class="bi bi-basket-fill display-5 text-success me-4"></i>
                        <div>
                            <span class="badge bg-success mb-1 fw-bold">DOMICILIO</span>
                            <h5 class="card-title fw-bold mb-1">Entrega de Restaurante 'La Parrilla'</h5>
                            <p class="mb-0 text-muted small">
                                Recoger en: **Restaurante Calle 15** | Entregar en: **Res. El Bosque**
                            </p>
                            <p class="mb-0 text-muted small">
                                Distancia Total: **6.8 km** | Ganancia Estimada: **$12.00**
                            </p>
                        </div>
                    </div>

                    <div class="text-end">
                        <span class="text-success fw-bold d-block mb-2" style="font-size: 1.5rem;">5 min</span>
                        <button class="btn btn-success fw-bold me-2 accept-button"><i class="bi bi-check2"></i> Aceptar</button>
                        <button class="btn btn-danger reject-button"><i class="bi bi-x"></i></button>
                    </div>

                </div>
            </div>
        </div>
        
        <!-- Mensaje de No Solicitudes (Oculto por defecto) -->
        <div id="no-requests-message" class="text-center p-5 bg-light rounded-3 mt-4" style="display: none;">
            <i class="bi bi-search display-3 text-muted mb-3"></i>
            <p class="lead">No hay nuevas solicitudes en este momento.</p>
            <p class="text-muted">Asegúrate de estar "Conectado" y espera nuevos servicios.</p>
        </div>
    </div>
    
</div>

<style>
    /* Estilo del botón de estado ON/OFF */
    .status-button {
        transition: all 0.3s ease;
        min-width: 200px;
        border-radius: 10px;
    }
    .status-online {
        background-color: var(--yummy-dark-green);
        color: white;
        border: none;
    }
    .status-offline {
        background-color: var(--bs-danger);
        color: white;
        border: none;
    }

    /* Estilo para las tarjetas de solicitud */
    .request-card {
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border-left: 5px solid; /* Usado para indicar el tipo de servicio */
    }

    .request-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }

    .accept-button, .reject-button {
        border-radius: 8px;
        min-width: 80px;
    }
</style>

<script>
    // JavaScript para simular el cambio de estado y la aceptación/rechazo
    const statusButton = document.getElementById('toggle-status');
    const serviceRequestsContainer = document.getElementById('service-requests');
    const noRequestsMessage = document.getElementById('no-requests-message');
    let isOnline = true;

    // Función para alternar el estado
    statusButton.addEventListener('click', function() {
        isOnline = !isOnline;
        if (isOnline) {
            this.classList.remove('status-offline');
            this.classList.add('status-online');
            this.innerHTML = '<i class="bi bi-toggle-on me-2"></i> Estado: Conectado';
            // Simulación: mostrar peticiones cuando está conectado
            serviceRequestsContainer.style.display = 'grid';
            noRequestsMessage.style.display = 'none';
        } else {
            this.classList.remove('status-online');
            this.classList.add('status-offline');
            this.innerHTML = '<i class="bi bi-toggle-off me-2"></i> Estado: Desconectado';
            // Simulación: ocultar peticiones cuando está desconectado
            serviceRequestsContainer.style.display = 'none';
            noRequestsMessage.style.display = 'block';
        }
    });

    // Función para manejar la acción de aceptar/rechazar (simulación)
    serviceRequestsContainer.addEventListener('click', function(e) {
        let card = e.target.closest('.request-card');
        if (!card) return;

        let action = '';
        if (e.target.closest('.accept-button')) {
            action = 'aceptada';
        } else if (e.target.closest('.reject-button')) {
            action = 'rechazada';
        }

        if (action) {
            const serviceType = card.dataset.serviceType;
            // Aquí iría la llamada AJAX al backend para registrar la acción
            
            // Simulación visual: remover la tarjeta
            card.remove(); 
            
            // Mostrar mensaje de éxito (usando una alerta simple en este caso)
            alert(`¡Solicitud de ${serviceType.toUpperCase()} ${action} con éxito!`);

            // Simulación: Si no quedan tarjetas, mostrar el mensaje de no peticiones
            if (serviceRequestsContainer.querySelectorAll('.request-card').length === 0) {
                 noRequestsMessage.style.display = 'block';
            }
        }
    });

    // Inicializar el estado (puede basarse en un valor de Django)
    if (!isOnline) {
        statusButton.click();
    }
</script>
{% endblock %}